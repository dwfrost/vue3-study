<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¬¬11ç« ï¼šç»„åˆå¼APIæ·±åº¦è§£æ - å®æˆ˜æ¼”ç¤º</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .content {
      padding: 30px;
    }

    .demo-section {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 30px;
      border-left: 4px solid #4facfe;
    }

    .demo-section h3 {
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 1.3rem;
    }

    .demo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .demo-card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .demo-card h4 {
      color: #4facfe;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }

    .counter-controls {
      display: flex;
      gap: 10px;
      margin: 15px 0;
    }

    .btn {
      background: #4facfe;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .btn:hover {
      background: #3b8bdb;
      transform: translateY(-1px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn.danger {
      background: #e74c3c;
    }

    .btn.danger:hover {
      background: #c0392b;
    }

    .btn.success {
      background: #27ae60;
    }

    .btn.success:hover {
      background: #229954;
    }

    .status-display {
      padding: 15px;
      border-radius: 6px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 0.9rem;
    }

    .status-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .status-info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .status-warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    .input-group {
      margin: 15px 0;
    }

    .input-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #555;
    }

    .input-group input, .input-group select {
      width: 100%;
      padding: 10px;
      border: 2px solid #e9ecef;
      border-radius: 6px;
      font-size: 0.9rem;
      transition: border-color 0.3s ease;
    }

    .input-group input:focus, .input-group select:focus {
      outline: none;
      border-color: #4facfe;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #4facfe;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .mouse-tracker {
      background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      color: #555;
    }

    .theme-switcher {
      padding: 20px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .theme-light {
      background: #ffffff;
      color: #333333;
    }

    .theme-dark {
      background: #2c3e50;
      color: #ecf0f1;
    }

    .lifecycle-log {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      padding: 15px;
      max-height: 200px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.8rem;
      line-height: 1.4;
    }

    .log-entry {
      margin: 2px 0;
      padding: 2px 5px;
      border-radius: 3px;
    }

    .log-mount { background: #d4edda; color: #155724; }
    .log-update { background: #fff3cd; color: #856404; }
    .log-unmount { background: #f8d7da; color: #721c24; }
    .log-effect { background: #d1ecf1; color: #0c5460; }

    .composable-demo {
      border: 2px dashed #4facfe;
      border-radius: 8px;
      padding: 20px;
      margin: 10px 0;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(45deg, #4facfe, #00f2fe);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
    }

    .performance-meter {
      background: linear-gradient(to right, #11998e, #38ef7d);
      height: 20px;
      border-radius: 10px;
      position: relative;
      overflow: hidden;
    }

    .performance-meter::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .code-block {
      background: #2d3748;
      color: #e2e8f0;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Fira Code', 'Monaco', monospace;
      font-size: 0.85rem;
      line-height: 1.5;
      overflow-x: auto;
      margin: 15px 0;
    }

    .code-keyword { color: #f56565; }
    .code-string { color: #68d391; }
    .code-function { color: #63b3ed; }
    .code-comment { color: #a0aec0; font-style: italic; }

    @media (max-width: 768px) {
      .demo-grid {
        grid-template-columns: 1fr;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .content {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="container">
      <div class="header">
        <h1>ğŸš€ Vue3 ç»„åˆå¼APIæ·±åº¦è§£æ</h1>
        <p>æ¢ç´¢Composition APIçš„å¼ºå¤§åŠŸèƒ½å’Œå®é™…åº”ç”¨</p>
      </div>

      <div class="content">
        <!-- åŸºç¡€å“åº”å¼APIæ¼”ç¤º -->
        <div class="demo-section">
          <h3>ğŸ“¦ åŸºç¡€å“åº”å¼APIæ¼”ç¤º</h3>
          <div class="demo-grid">
            <!-- refè®¡æ•°å™¨ -->
            <div class="demo-card">
              <h4>ref è®¡æ•°å™¨</h4>
              <div class="status-display status-info">
                å½“å‰è®¡æ•°: {{ refCounter.count }}<br>
                åŒå€å€¼: {{ refCounter.doubled }}
              </div>
              <div class="counter-controls">
                <button class="btn" @click="refCounter.increment">+1</button>
                <button class="btn" @click="refCounter.decrement">-1</button>
                <button class="btn danger" @click="refCounter.reset">é‡ç½®</button>
              </div>
            </div>

            <!-- reactiveç”¨æˆ·ä¿¡æ¯ -->
            <div class="demo-card">
              <h4>reactive ç”¨æˆ·ä¿¡æ¯</h4>
              <div class="user-info">
                <div class="user-avatar">{{ userState.name.charAt(0) }}</div>
                <div>
                  <div><strong>{{ userState.name }}</strong></div>
                  <div>å¹´é¾„: {{ userState.age }} | åŸå¸‚: {{ userState.profile.city }}</div>
                </div>
              </div>
              <div class="input-group">
                <label>å§“å:</label>
                <input v-model="userState.name" placeholder="è¾“å…¥å§“å">
              </div>
              <div class="input-group">
                <label>å¹´é¾„:</label>
                <input v-model.number="userState.age" type="number" placeholder="è¾“å…¥å¹´é¾„">
              </div>
            </div>
          </div>
        </div>

        <!-- computedå’Œwatchæ¼”ç¤º -->
        <div class="demo-section">
          <h3>ğŸ§® è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨æ¼”ç¤º</h3>
          <div class="demo-grid">
            <!-- computedæ¼”ç¤º -->
            <div class="demo-card">
              <h4>computed è´­ç‰©è½¦è®¡ç®—</h4>
              <div class="status-display status-success">
                å•†å“æ•°é‡: {{ cart.items.length }}<br>
                æ€»ä»·: Â¥{{ cart.totalPrice }}<br>
                å¹³å‡ä»·æ ¼: Â¥{{ cart.averagePrice }}
              </div>
              <button class="btn" @click="addRandomItem">æ·»åŠ å•†å“</button>
              <button class="btn danger" @click="clearCart">æ¸…ç©ºè´­ç‰©è½¦</button>
            </div>

            <!-- watchæ¼”ç¤º -->
            <div class="demo-card">
              <h4>watch æœç´¢æ¼”ç¤º</h4>
              <div class="input-group">
                <label>æœç´¢å…³é”®è¯:</label>
                <input v-model="searchQuery" placeholder="è¾“å…¥æœç´¢å…³é”®è¯">
              </div>
              <div class="status-display status-warning" v-if="searchQuery">
                æœç´¢: "{{ searchQuery }}"<br>
                æœç´¢æ¬¡æ•°: {{ searchCount }}
              </div>
            </div>
          </div>
        </div>

        <!-- ç”Ÿå‘½å‘¨æœŸæ¼”ç¤º -->
        <div class="demo-section">
          <h3>ğŸ£ ç”Ÿå‘½å‘¨æœŸHooksæ¼”ç¤º</h3>
          <div class="demo-card">
            <h4>ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ—¥å¿—</h4>
            <div class="counter-controls">
              <button class="btn" @click="toggleChildComponent">
                {{ showChild ? 'å¸è½½' : 'æŒ‚è½½' }} å­ç»„ä»¶
              </button>
              <button class="btn" @click="clearLifecycleLogs">æ¸…ç©ºæ—¥å¿—</button>
            </div>
            <div class="lifecycle-log">
              <div v-for="log in lifecycleLogs" :key="log.id" :class="['log-entry', log.type]">
                [{{ log.time }}] {{ log.message }}
              </div>
            </div>
            
            <!-- åŠ¨æ€å­ç»„ä»¶ -->
            <child-component v-if="showChild" @log="addLifecycleLog"></child-component>
          </div>
        </div>

        <!-- ä¾èµ–æ³¨å…¥æ¼”ç¤º -->
        <div class="demo-section">
          <h3>ğŸ’‰ ä¾èµ–æ³¨å…¥æ¼”ç¤º</h3>
          <div class="demo-grid">
            <!-- ä¸»é¢˜åˆ‡æ¢ -->
            <div class="demo-card">
              <h4>ä¸»é¢˜æä¾›è€…</h4>
              <div class="input-group">
                <label>é€‰æ‹©ä¸»é¢˜:</label>
                <select v-model="theme" @change="updateTheme">
                  <option value="light">æµ…è‰²ä¸»é¢˜</option>
                  <option value="dark">æ·±è‰²ä¸»é¢˜</option>
                </select>
              </div>
              <div :class="['theme-switcher', `theme-${theme}`]">
                å½“å‰ä¸»é¢˜: {{ theme }}
              </div>
            </div>

            <!-- ç”¨æˆ·ä¸Šä¸‹æ–‡ -->
            <div class="demo-card">
              <h4>ç”¨æˆ·ä¸Šä¸‹æ–‡</h4>
              <div class="status-display status-info">
                å½“å‰ç”¨æˆ·: {{ currentUser.name }}<br>
                æƒé™ç­‰çº§: {{ currentUser.role }}<br>
                ç™»å½•çŠ¶æ€: {{ isLoggedIn ? 'å·²ç™»å½•' : 'æœªç™»å½•' }}
              </div>
              <button class="btn" @click="toggleLogin">
                {{ isLoggedIn ? 'é€€å‡ºç™»å½•' : 'ç™»å½•' }}
              </button>
            </div>
          </div>
        </div>

        <!-- Composableå‡½æ•°æ¼”ç¤º -->
        <div class="demo-section">
          <h3>ğŸ”§ Composableå‡½æ•°æ¼”ç¤º</h3>
          <div class="demo-grid">
            <!-- é¼ æ ‡è¿½è¸ª -->
            <div class="demo-card">
              <h4>useMouse - é¼ æ ‡ä½ç½®è¿½è¸ª</h4>
              <div class="mouse-tracker">
                <div><strong>é¼ æ ‡åæ ‡</strong></div>
                <div>X: {{ mousePosition.x }}</div>
                <div>Y: {{ mousePosition.y }}</div>
                <div><small>åœ¨é¡µé¢ä¸Šç§»åŠ¨é¼ æ ‡è¯•è¯•</small></div>
              </div>
            </div>

            <!-- å¼‚æ­¥æ•°æ®è·å– -->
            <div class="demo-card">
              <h4>useAsyncData - å¼‚æ­¥æ•°æ®</h4>
              <div class="status-display" :class="asyncData.error ? 'status-error' : 'status-success'">
                <span v-if="asyncData.loading" class="loading"></span>
                <span v-if="asyncData.loading">åŠ è½½ä¸­...</span>
                <span v-else-if="asyncData.error">é”™è¯¯: {{ asyncData.error }}</span>
                <span v-else-if="asyncData.data">æ•°æ®: {{ asyncData.data }}</span>
                <span v-else>æš‚æ— æ•°æ®</span>
              </div>
              <div class="counter-controls">
                <button class="btn" @click="fetchData" :disabled="asyncData.loading">è·å–æ•°æ®</button>
                <button class="btn" @click="fetchErrorData" :disabled="asyncData.loading">æ¨¡æ‹Ÿé”™è¯¯</button>
              </div>
            </div>

            <!-- æœ¬åœ°å­˜å‚¨ -->
            <div class="demo-card">
              <h4>useStorage - æœ¬åœ°å­˜å‚¨</h4>
              <div class="input-group">
                <label>ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨:</label>
                <input v-model="storageValue" placeholder="è¾“å…¥å€¼ï¼Œè‡ªåŠ¨ä¿å­˜">
              </div>
              <div class="status-display status-info">
                å­˜å‚¨çš„å€¼: {{ storageValue }}
              </div>
            </div>
          </div>
        </div>

        <!-- æ€§èƒ½å¯¹æ¯”æ¼”ç¤º -->
        <div class="demo-section">
          <h3>ğŸ“Š æ€§èƒ½å¯¹æ¯”æ¼”ç¤º</h3>
          <div class="demo-card">
            <h4>Options API vs Composition API</h4>
            <div class="counter-controls">
              <button class="btn" @click="runPerformanceTest">è¿è¡Œæ€§èƒ½æµ‹è¯•</button>
              <button class="btn success" @click="clearPerformanceResults">æ¸…ç©ºç»“æœ</button>
            </div>
            <div v-if="performanceResults" class="status-display status-success">
              <div><strong>æµ‹è¯•ç»“æœ:</strong></div>
              <div>Options API: {{ performanceResults.optionsTime }}ms</div>
              <div>Composition API: {{ performanceResults.compositionTime }}ms</div>
              <div>æ€§èƒ½æå‡: {{ performanceResults.improvement }}%</div>
              <div class="performance-meter" style="margin-top: 10px;"></div>
            </div>
          </div>
        </div>

        <!-- ä»£ç ç¤ºä¾‹ -->
        <div class="demo-section">
          <h3>ğŸ’» æ ¸å¿ƒä»£ç ç¤ºä¾‹</h3>
          <div class="demo-card">
            <h4>useCounter Composableå®ç°</h4>
            <div class="code-block">
<span class="code-keyword">function</span> <span class="code-function">useCounter</span>(initialValue = <span class="code-string">0</span>) {
  <span class="code-keyword">const</span> count = <span class="code-function">ref</span>(initialValue)
  
  <span class="code-keyword">const</span> increment = () => count.value++
  <span class="code-keyword">const</span> decrement = () => count.value--
  <span class="code-keyword">const</span> reset = () => count.value = initialValue
  
  <span class="code-keyword">const</span> doubled = <span class="code-function">computed</span>(() => count.value * <span class="code-string">2</span>)
  
  <span class="code-comment">// ç›‘å¬è®¡æ•°å˜åŒ–</span>
  <span class="code-function">watch</span>(count, (newVal, oldVal) => {
    console.log(`Count changed: ${oldVal} -> ${newVal}`)
  })
  
  <span class="code-keyword">return</span> { count, doubled, increment, decrement, reset }
}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref, reactive, computed, watch, watchEffect, onMounted, onUnmounted, provide, inject } = Vue

    // å­ç»„ä»¶å®šä¹‰
    const ChildComponent = {
      setup(props, { emit }) {
        const internalCount = ref(0)
        
        onMounted(() => {
          emit('log', { message: 'å­ç»„ä»¶å·²æŒ‚è½½', type: 'log-mount' })
        })
        
        onUnmounted(() => {
          emit('log', { message: 'å­ç»„ä»¶å³å°†å¸è½½', type: 'log-unmount' })
        })
        
        watchEffect(() => {
          emit('log', { message: `å­ç»„ä»¶å†…éƒ¨è®¡æ•°: ${internalCount.value}`, type: 'log-effect' })
        })
        
        const increment = () => {
          internalCount.value++
          emit('log', { message: 'å­ç»„ä»¶è®¡æ•°æ›´æ–°', type: 'log-update' })
        }
        
        return {
          internalCount,
          increment
        }
      },
      template: `
        <div class="composable-demo">
          <h5>åŠ¨æ€å­ç»„ä»¶</h5>
          <div>å†…éƒ¨è®¡æ•°: {{ internalCount }}</div>
          <button class="btn" @click="increment">å¢åŠ è®¡æ•°</button>
        </div>
      `
    }

    // åˆ›å»ºåº”ç”¨
    createApp({
      components: {
        ChildComponent
      },
      setup() {
        // ===== åŸºç¡€å“åº”å¼API =====
        
        // useCounter composable
        function useCounter(initialValue = 0) {
          const count = ref(initialValue)
          
          const increment = () => count.value++
          const decrement = () => count.value--
          const reset = () => count.value = initialValue
          
          const doubled = computed(() => count.value * 2)
          
          return { count, doubled, increment, decrement, reset }
        }
        
        // refè®¡æ•°å™¨
        const refCounter = useCounter(0)
        
        // reactiveç”¨æˆ·çŠ¶æ€
        const userState = reactive({
          name: 'Vue.js',
          age: 3,
          profile: {
            city: 'ä¸Šæµ·'
          }
        })
        
        // ===== è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨ =====
        
        // è´­ç‰©è½¦çŠ¶æ€
        const cart = reactive({
          items: [
            { id: 1, name: 'MacBook Pro', price: 12999 },
            { id: 2, name: 'iPhone 13', price: 5999 }
          ]
        })
        
        // è´­ç‰©è½¦è®¡ç®—å±æ€§
        const cartComputeds = {
          totalPrice: computed(() => 
            cart.items.reduce((sum, item) => sum + item.price, 0)
          ),
          averagePrice: computed(() => 
            cart.items.length > 0 
              ? Math.round(cartComputeds.totalPrice.value / cart.items.length)
              : 0
          )
        }
        
        // å°†è®¡ç®—å±æ€§æ·»åŠ åˆ°cartå¯¹è±¡
        Object.assign(cart, cartComputeds)
        
        // æ·»åŠ éšæœºå•†å“
        const addRandomItem = () => {
          const products = [
            { name: 'iPad Air', price: 4399 },
            { name: 'AirPods Pro', price: 1999 },
            { name: 'Apple Watch', price: 2999 },
            { name: 'Magic Keyboard', price: 2399 }
          ]
          const randomProduct = products[Math.floor(Math.random() * products.length)]
          cart.items.push({
            id: Date.now(),
            ...randomProduct
          })
        }
        
        const clearCart = () => {
          cart.items = []
        }
        
        // æœç´¢æ¼”ç¤º
        const searchQuery = ref('')
        const searchCount = ref(0)
        
        watch(searchQuery, (newQuery, oldQuery) => {
          if (newQuery && newQuery !== oldQuery) {
            searchCount.value++
            console.log(`æœç´¢: "${newQuery}", ç¬¬${searchCount.value}æ¬¡æœç´¢`)
          }
        })
        
        // ===== ç”Ÿå‘½å‘¨æœŸæ¼”ç¤º =====
        
        const showChild = ref(false)
        const lifecycleLogs = ref([])
        
        const addLifecycleLog = (log) => {
          lifecycleLogs.value.push({
            id: Date.now(),
            time: new Date().toLocaleTimeString(),
            ...log
          })
        }
        
        const toggleChildComponent = () => {
          showChild.value = !showChild.value
        }
        
        const clearLifecycleLogs = () => {
          lifecycleLogs.value = []
        }
        
        onMounted(() => {
          addLifecycleLog({ message: 'ä¸»ç»„ä»¶å·²æŒ‚è½½', type: 'log-mount' })
        })
        
        // ===== ä¾èµ–æ³¨å…¥æ¼”ç¤º =====
        
        const theme = ref('light')
        const currentUser = ref({ name: 'Guest', role: 'visitor' })
        const isLoggedIn = ref(false)
        
        // æä¾›ä¾èµ–
        provide('theme', theme)
        provide('currentUser', currentUser)
        
        const updateTheme = () => {
          console.log('ä¸»é¢˜åˆ‡æ¢åˆ°:', theme.value)
        }
        
        const toggleLogin = () => {
          if (isLoggedIn.value) {
            currentUser.value = { name: 'Guest', role: 'visitor' }
            isLoggedIn.value = false
          } else {
            currentUser.value = { name: 'John Doe', role: 'admin' }
            isLoggedIn.value = true
          }
        }
        
        // ===== Composableå‡½æ•°æ¼”ç¤º =====
        
        // useMouse
        function useMouse() {
          const x = ref(0)
          const y = ref(0)
          
          const updatePosition = (event) => {
            x.value = event.clientX
            y.value = event.clientY
          }
          
          onMounted(() => {
            document.addEventListener('mousemove', updatePosition)
          })
          
          onUnmounted(() => {
            document.removeEventListener('mousemove', updatePosition)
          })
          
          return { x, y }
        }
        
        const mousePosition = useMouse()
        
        // useAsyncData
        function useAsyncData() {
          const data = ref(null)
          const loading = ref(false)
          const error = ref(null)
          
          const execute = async (promise) => {
            loading.value = true
            error.value = null
            
            try {
              const result = await promise
              data.value = result
            } catch (err) {
              error.value = err.message
            } finally {
              loading.value = false
            }
          }
          
          return { data, loading, error, execute }
        }
        
        const asyncData = useAsyncData()
        
        const fetchData = () => {
          asyncData.execute(
            new Promise((resolve) => {
              setTimeout(() => resolve('è·å–çš„æ•°æ®: ' + Math.random().toFixed(4)), 1500)
            })
          )
        }
        
        const fetchErrorData = () => {
          asyncData.execute(
            new Promise((resolve, reject) => {
              setTimeout(() => reject(new Error('ç½‘ç»œé”™è¯¯')), 1000)
            })
          )
        }
        
        // useStorage (ç®€åŒ–ç‰ˆ)
        function useStorage(key, defaultValue) {
          const storedValue = localStorage.getItem(key)
          const state = ref(storedValue ? JSON.parse(storedValue) : defaultValue)
          
          watch(state, (newValue) => {
            localStorage.setItem(key, JSON.stringify(newValue))
          })
          
          return state
        }
        
        const storageValue = useStorage('composition-demo-value', '')
        
        // ===== æ€§èƒ½æµ‹è¯• =====
        
        const performanceResults = ref(null)
        
        const runPerformanceTest = () => {
          const iterations = 1000
          
          // æ¨¡æ‹ŸOptions APIç»„ä»¶åˆ›å»º
          const startOptions = performance.now()
          for (let i = 0; i < iterations; i++) {
            // æ¨¡æ‹ŸOptions APIçš„åˆå§‹åŒ–å¼€é”€
            const optionsComponent = {
              data: () => ({ count: 0, items: [] }),
              computed: { doubled: function() { return this.count * 2 } },
              methods: { increment: function() { this.count++ } }
            }
          }
          const optionsTime = Math.round(performance.now() - startOptions)
          
          // æ¨¡æ‹ŸComposition APIç»„ä»¶åˆ›å»º
          const startComposition = performance.now()
          for (let i = 0; i < iterations; i++) {
            // æ¨¡æ‹ŸComposition APIçš„setupå‡½æ•°
            const setupFunction = () => {
              const count = ref(0)
              const items = ref([])
              const doubled = computed(() => count.value * 2)
              const increment = () => count.value++
              return { count, items, doubled, increment }
            }
          }
          const compositionTime = Math.round(performance.now() - startComposition)
          
          const improvement = Math.round(((optionsTime - compositionTime) / optionsTime) * 100)
          
          performanceResults.value = {
            optionsTime,
            compositionTime,
            improvement
          }
        }
        
        const clearPerformanceResults = () => {
          performanceResults.value = null
        }
        
        // ===== åˆå§‹åŒ– =====
        
        onMounted(() => {
          console.log('ğŸš€ Vue3 ç»„åˆå¼APIæ¼”ç¤ºå·²å¯åŠ¨')
          console.log('ğŸ“– æŸ¥çœ‹æ§åˆ¶å°ä»¥äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯')
        })
        
        return {
          // åŸºç¡€API
          refCounter,
          userState,
          
          // è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨
          cart,
          addRandomItem,
          clearCart,
          searchQuery,
          searchCount,
          
          // ç”Ÿå‘½å‘¨æœŸ
          showChild,
          lifecycleLogs,
          addLifecycleLog,
          toggleChildComponent,
          clearLifecycleLogs,
          
          // ä¾èµ–æ³¨å…¥
          theme,
          currentUser,
          isLoggedIn,
          updateTheme,
          toggleLogin,
          
          // Composableå‡½æ•°
          mousePosition,
          asyncData,
          fetchData,
          fetchErrorData,
          storageValue,
          
          // æ€§èƒ½æµ‹è¯•
          performanceResults,
          runPerformanceTest,
          clearPerformanceResults
        }
      }
    }).mount('#app')
  </script>
</body>
</html> 