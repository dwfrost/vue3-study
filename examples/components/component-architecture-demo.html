<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬10ç« ï¼šç»„ä»¶åŸºç¡€æ¶æ„æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .demo-section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .demo-section h2 {
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .demo-section h2::before {
            content: attr(data-icon);
            font-size: 1.5em;
        }

        .component-instance {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            transition: all 0.3s ease;
            position: relative;
        }

        .component-instance:hover {
            border-color: #4CAF50;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        }

        .component-instance.mounted {
            border-color: #4CAF50;
            background: #f1f8e9;
        }

        .component-instance.unmounted {
            border-color: #f44336;
            background: #ffebee;
            opacity: 0.7;
        }

        .component-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .component-name {
            font-weight: bold;
            color: #333;
            font-size: 1.2em;
        }

        .component-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-created {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status-mounted {
            background: #e8f5e8;
            color: #4caf50;
        }

        .status-unmounted {
            background: #ffebee;
            color: #f44336;
        }

        .component-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-item {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
        }

        .info-label {
            font-weight: bold;
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .info-value {
            color: #333;
            word-break: break-word;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: #2196F3;
        }

        .btn-success {
            background: #4CAF50;
        }

        .btn-warning {
            background: #FF9800;
        }

        .btn-danger {
            background: #f44336;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .lifecycle-log {
            background: #263238;
            color: #00e676;
            font-family: 'Courier New', monospace;
            padding: 20px;
            border-radius: 8px;
            height: 300px;
            overflow-y: auto;
            margin-top: 20px;
            white-space: pre-wrap;
        }

        .communication-demo {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .parent-component,
        .child-component {
            padding: 20px;
            border-radius: 8px;
            background: white;
            border: 2px solid #e0e0e0;
        }

        .parent-component {
            border-color: #2196F3;
            background: #e3f2fd;
        }

        .child-component {
            border-color: #FF9800;
            background: #fff3e0;
        }

        .props-display {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
        }

        @media (max-width: 768px) {
            .communication-demo {
                grid-template-columns: 1fr;
            }
            
            .component-info {
                grid-template-columns: 1fr;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .highlight {
            background: #ffeb3b !important;
            transition: background 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ï¸ Vue3ç»„ä»¶åŸºç¡€æ¶æ„æ¼”ç¤º</h1>
            <p>æ·±å…¥ç†è§£Vue3ç»„ä»¶ç³»ç»Ÿçš„æ ¸å¿ƒåŸç†</p>
        </div>

        <div class="content">
            <!-- åŸºç¡€ç»„ä»¶æ¼”ç¤º -->
            <div class="demo-section">
                <h2 data-icon="ğŸ”§">åŸºç¡€ç»„ä»¶æ¼”ç¤º</h2>
                <div id="basic-component" class="component-instance">
                    <div class="component-header">
                        <span class="component-name">BasicComponent</span>
                        <span class="component-status status-created">Created</span>
                    </div>
                    <div class="component-info">
                        <div class="info-item">
                            <div class="info-label">UID</div>
                            <div class="info-value" id="basic-uid">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Data</div>
                            <div class="info-value" id="basic-data">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">æ¸²æŸ“ç»“æœ</div>
                            <div class="info-value" id="basic-render">-</div>
                        </div>
                    </div>
                    <div class="controls">
                        <button class="btn btn-success" onclick="mountBasicComponent()">æŒ‚è½½ç»„ä»¶</button>
                        <button class="btn btn-primary" onclick="updateBasicComponent()" disabled id="update-basic-btn">æ›´æ–°æ•°æ®</button>
                        <button class="btn btn-danger" onclick="unmountBasicComponent()" disabled id="unmount-basic-btn">å¸è½½ç»„ä»¶</button>
                    </div>
                </div>
            </div>

            <!-- ç”Ÿå‘½å‘¨æœŸæ¼”ç¤º -->
            <div class="demo-section">
                <h2 data-icon="ğŸ­">ç”Ÿå‘½å‘¨æœŸæ¼”ç¤º</h2>
                <div id="lifecycle-component" class="component-instance">
                    <div class="component-header">
                        <span class="component-name">LifecycleComponent</span>
                        <span class="component-status status-created">Created</span>
                    </div>
                    <div class="component-info">
                        <div class="info-item">
                            <div class="info-label">å½“å‰é˜¶æ®µ</div>
                            <div class="info-value" id="lifecycle-stage">å·²åˆ›å»º</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">æ›´æ–°æ¬¡æ•°</div>
                            <div class="info-value" id="lifecycle-updates">0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">æ¸²æŸ“ç»“æœ</div>
                            <div class="info-value" id="lifecycle-render">-</div>
                        </div>
                    </div>
                    <div class="controls">
                        <button class="btn btn-success" onclick="mountLifecycleComponent()">æŒ‚è½½ç»„ä»¶</button>
                        <button class="btn btn-warning" onclick="triggerLifecycleUpdate()" disabled id="trigger-update-btn">è§¦å‘æ›´æ–°</button>
                        <button class="btn btn-danger" onclick="unmountLifecycleComponent()" disabled id="unmount-lifecycle-btn">å¸è½½ç»„ä»¶</button>
                    </div>
                </div>
                <div class="lifecycle-log" id="lifecycle-log">ç­‰å¾…ç”Ÿå‘½å‘¨æœŸäº‹ä»¶...</div>
            </div>

            <!-- ç»„ä»¶é€šä¿¡æ¼”ç¤º -->
            <div class="demo-section">
                <h2 data-icon="ğŸ“¡">ç»„ä»¶é€šä¿¡æ¼”ç¤º</h2>
                <div class="communication-demo">
                    <div class="parent-component">
                        <h3>çˆ¶ç»„ä»¶ (ParentComponent)</h3>
                        <div class="props-display">
                            <div>parentMessage: <span id="parent-message">"From Parent"</span></div>
                            <div>childCount: <span id="parent-child-count">0</span></div>
                        </div>
                        <div class="controls">
                            <button class="btn btn-primary" onclick="updateParentMessage()">æ›´æ–°æ¶ˆæ¯</button>
                            <button class="btn btn-success" onclick="mountCommunicationComponents()">æŒ‚è½½ç»„ä»¶</button>
                        </div>
                    </div>
                    <div class="child-component">
                        <h3>å­ç»„ä»¶ (ChildComponent)</h3>
                        <div class="props-display">
                            <div>æ¥æ”¶åˆ°çš„æ¶ˆæ¯: <span id="child-received-message">-</span></div>
                            <div>æœ¬åœ°è®¡æ•°: <span id="child-local-count">0</span></div>
                        </div>
                        <div class="controls">
                            <button class="btn btn-warning" onclick="triggerChildEvent()" disabled id="child-event-btn">è§¦å‘äº‹ä»¶</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ€§èƒ½ç›‘æ§ -->
            <div class="demo-section">
                <h2 data-icon="ğŸ“Š">æ€§èƒ½ç›‘æ§</h2>
                <div class="component-info">
                    <div class="info-item">
                        <div class="info-label">æ€»ç»„ä»¶æ•°</div>
                        <div class="info-value" id="total-components">0</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">å·²æŒ‚è½½ç»„ä»¶</div>
                        <div class="info-value" id="mounted-components">0</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">å·²å¸è½½ç»„ä»¶</div>
                        <div class="info-value" id="unmounted-components">0</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">å†…å­˜ä½¿ç”¨</div>
                        <div class="info-value" id="memory-usage">æ­£å¸¸</div>
                    </div>
                </div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="refreshStats()">åˆ·æ–°ç»Ÿè®¡</button>
                    <button class="btn btn-warning" onclick="clearAllComponents()">æ¸…ç†æ‰€æœ‰ç»„ä»¶</button>
                </div>
            </div>
        </div>
    </div>

    <script src="01-component-architecture-demo.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let componentManager = new ComponentManager();
        let basicInstance = null;
        let lifecycleInstance = null;
        let parentInstance = null;
        let childInstance = null;
        let logContainer = document.getElementById('lifecycle-log');

        // é‡å†™console.logæ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            
            // æ ¼å¼åŒ–æ—¥å¿—ä¿¡æ¯
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
            ).join(' ');
            
            // æ·»åŠ æ—¶é—´æˆ³
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            
            // æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
            if (logContainer) {
                logContainer.textContent += logMessage;
                logContainer.scrollTop = logContainer.scrollHeight;
            }
        };

        // åŸºç¡€ç»„ä»¶æ“ä½œ
        function mountBasicComponent() {
            if (!basicInstance) {
                const BasicComponent = new ComponentDefinition({
                    name: 'BasicComponent',
                    data() {
                        return {
                            message: 'Hello Vue3',
                            count: 0
                        }
                    },
                    methods: {
                        increment() {
                            this.count++;
                        }
                    },
                    render(ctx) {
                        return {
                            text: `${ctx.message} - Count: ${ctx.count}`
                        }
                    }
                });

                basicInstance = componentManager.createInstance(BasicComponent);
            }

            componentManager.mountComponent(basicInstance);
            updateBasicComponentDisplay();
            
            document.querySelector('#basic-component .component-status').textContent = 'Mounted';
            document.querySelector('#basic-component .component-status').className = 'component-status status-mounted';
            document.querySelector('#basic-component').classList.add('mounted');
            
            document.getElementById('update-basic-btn').disabled = false;
            document.getElementById('unmount-basic-btn').disabled = false;
        }

        function updateBasicComponent() {
            if (basicInstance && basicInstance.increment) {
                basicInstance.increment();
                updateBasicComponentDisplay();
                highlightElement('basic-component');
            }
        }

        function unmountBasicComponent() {
            if (basicInstance) {
                componentManager.unmountComponent(basicInstance);
                
                document.querySelector('#basic-component .component-status').textContent = 'Unmounted';
                document.querySelector('#basic-component .component-status').className = 'component-status status-unmounted';
                document.querySelector('#basic-component').classList.remove('mounted');
                document.querySelector('#basic-component').classList.add('unmounted');
                
                document.getElementById('update-basic-btn').disabled = true;
                document.getElementById('unmount-basic-btn').disabled = true;
            }
        }

        function updateBasicComponentDisplay() {
            if (basicInstance) {
                document.getElementById('basic-uid').textContent = basicInstance.uid;
                document.getElementById('basic-data').textContent = JSON.stringify(basicInstance.data);
                
                if (basicInstance.subTree) {
                    document.getElementById('basic-render').textContent = basicInstance.subTree.text;
                }
            }
        }

        // ç”Ÿå‘½å‘¨æœŸç»„ä»¶æ“ä½œ
        function mountLifecycleComponent() {
            if (!lifecycleInstance) {
                const LifecycleComponent = new ComponentDefinition({
                    name: 'LifecycleComponent',
                    data() {
                        return {
                            message: 'Lifecycle Demo',
                            updateCount: 0
                        }
                    },
                    beforeCreate() {
                        console.log('ğŸ¬ beforeCreate: ç»„ä»¶å®ä¾‹åˆšåˆ›å»º');
                        updateLifecycleStage('beforeCreate');
                    },
                    created() {
                        console.log('ğŸ­ created: ç»„ä»¶å®ä¾‹åˆ›å»ºå®Œæˆ');
                        updateLifecycleStage('created');
                    },
                    beforeMount() {
                        console.log('ğŸª beforeMount: ç»„ä»¶æŒ‚è½½å‰');
                        updateLifecycleStage('beforeMount');
                    },
                    mounted() {
                        console.log('ğŸ¨ mounted: ç»„ä»¶æŒ‚è½½å®Œæˆ');
                        updateLifecycleStage('mounted');
                        
                        // è‡ªåŠ¨è§¦å‘æ›´æ–°
                        setTimeout(() => {
                            this.message = 'Updated by timer';
                        }, 3000);
                    },
                    beforeUpdate() {
                        console.log('ğŸ”„ beforeUpdate: ç»„ä»¶æ›´æ–°å‰');
                        this.updateCount++;
                        updateLifecycleStage('beforeUpdate');
                    },
                    updated() {
                        console.log('âœ… updated: ç»„ä»¶æ›´æ–°å®Œæˆ');
                        updateLifecycleStage('updated');
                        updateLifecycleDisplay();
                    },
                    beforeUnmount() {
                        console.log('ğŸšª beforeUnmount: ç»„ä»¶å¸è½½å‰');
                        updateLifecycleStage('beforeUnmount');
                    },
                    unmounted() {
                        console.log('ğŸ‘‹ unmounted: ç»„ä»¶å¸è½½å®Œæˆ');
                        updateLifecycleStage('unmounted');
                    },
                    render(ctx) {
                        return {
                            text: `${ctx.message} (æ›´æ–°${ctx.updateCount}æ¬¡)`
                        }
                    }
                });

                lifecycleInstance = componentManager.createInstance(LifecycleComponent);
            }

            componentManager.mountComponent(lifecycleInstance);
            
            document.querySelector('#lifecycle-component .component-status').textContent = 'Mounted';
            document.querySelector('#lifecycle-component .component-status').className = 'component-status status-mounted';
            document.querySelector('#lifecycle-component').classList.add('mounted');
            
            document.getElementById('trigger-update-btn').disabled = false;
            document.getElementById('unmount-lifecycle-btn').disabled = false;
        }

        function triggerLifecycleUpdate() {
            if (lifecycleInstance) {
                lifecycleInstance.data.message = `æ‰‹åŠ¨æ›´æ–° ${new Date().toLocaleTimeString()}`;
                if (lifecycleInstance.update) {
                    lifecycleInstance.update();
                }
                highlightElement('lifecycle-component');
            }
        }

        function unmountLifecycleComponent() {
            if (lifecycleInstance) {
                componentManager.unmountComponent(lifecycleInstance);
                
                document.querySelector('#lifecycle-component .component-status').textContent = 'Unmounted';
                document.querySelector('#lifecycle-component .component-status').className = 'component-status status-unmounted';
                document.querySelector('#lifecycle-component').classList.remove('mounted');
                document.querySelector('#lifecycle-component').classList.add('unmounted');
                
                document.getElementById('trigger-update-btn').disabled = true;
                document.getElementById('unmount-lifecycle-btn').disabled = true;
            }
        }

        function updateLifecycleStage(stage) {
            document.getElementById('lifecycle-stage').textContent = stage;
        }

        function updateLifecycleDisplay() {
            if (lifecycleInstance) {
                document.getElementById('lifecycle-updates').textContent = lifecycleInstance.data.updateCount;
                if (lifecycleInstance.subTree) {
                    document.getElementById('lifecycle-render').textContent = lifecycleInstance.subTree.text;
                }
            }
        }

        // ç»„ä»¶é€šä¿¡æ“ä½œ
        function mountCommunicationComponents() {
            // åˆ›å»ºçˆ¶ç»„ä»¶
            const ParentComponent = new ComponentDefinition({
                name: 'ParentComponent',
                data() {
                    return {
                        parentMessage: 'From Parent',
                        childCount: 0
                    }
                },
                methods: {
                    onChildUpdate(count) {
                        console.log(`çˆ¶ç»„ä»¶æ¥æ”¶åˆ°å­ç»„ä»¶äº‹ä»¶: ${count}`);
                        this.childCount = count;
                        updateCommunicationDisplay();
                    }
                },
                render(ctx) {
                    return {
                        text: `Parent: ${ctx.parentMessage}, Child Count: ${ctx.childCount}`
                    }
                }
            });

            // åˆ›å»ºå­ç»„ä»¶
            const ChildComponent = new ComponentDefinition({
                name: 'ChildComponent',
                props: {
                    message: String,
                    count: Number
                },
                data() {
                    return {
                        localCount: 0
                    }
                },
                methods: {
                    handleClick() {
                        this.localCount++;
                        this.emit('update', this.localCount);
                        updateCommunicationDisplay();
                    }
                },
                render(ctx) {
                    return {
                        text: `Child: ${ctx.message}, Local: ${ctx.localCount}, Prop: ${ctx.count}`
                    }
                }
            });

            parentInstance = componentManager.createInstance(ParentComponent);
            childInstance = componentManager.createInstance(ChildComponent, {
                message: parentInstance.data.parentMessage,
                count: parentInstance.data.childCount,
                onUpdate: parentInstance.onChildUpdate.bind(parentInstance)
            }, parentInstance);

            componentManager.mountComponent(parentInstance);
            componentManager.mountComponent(childInstance);

            document.getElementById('child-event-btn').disabled = false;
            updateCommunicationDisplay();
        }

        function updateParentMessage() {
            if (parentInstance) {
                parentInstance.data.parentMessage = `Updated at ${new Date().toLocaleTimeString()}`;
                updateCommunicationDisplay();
                highlightElement('parent-component');
            }
        }

        function triggerChildEvent() {
            if (childInstance && childInstance.handleClick) {
                childInstance.handleClick();
                highlightElement('child-component');
            }
        }

        function updateCommunicationDisplay() {
            if (parentInstance) {
                document.getElementById('parent-message').textContent = `"${parentInstance.data.parentMessage}"`;
                document.getElementById('parent-child-count').textContent = parentInstance.data.childCount;
            }
            
            if (childInstance) {
                document.getElementById('child-received-message').textContent = childInstance.props.message || '-';
                document.getElementById('child-local-count').textContent = childInstance.data.localCount;
            }
        }

        // æ€§èƒ½ç›‘æ§
        function refreshStats() {
            const instances = Array.from(componentManager.instances.values());
            const mounted = instances.filter(i => i.isMounted).length;
            const unmounted = instances.filter(i => i.isUnmounted).length;
            
            document.getElementById('total-components').textContent = instances.length;
            document.getElementById('mounted-components').textContent = mounted;
            document.getElementById('unmounted-components').textContent = unmounted;
            
            // æ¨¡æ‹Ÿå†…å­˜ä½¿ç”¨çŠ¶æ€
            const memoryStatus = instances.length > 10 ? 'è¾ƒé«˜' : instances.length > 5 ? 'ä¸­ç­‰' : 'æ­£å¸¸';
            document.getElementById('memory-usage').textContent = memoryStatus;
        }

        function clearAllComponents() {
            const instances = Array.from(componentManager.instances.values());
            instances.forEach(instance => {
                if (!instance.isUnmounted) {
                    componentManager.unmountComponent(instance);
                }
            });
            
            // é‡ç½®å¼•ç”¨
            basicInstance = null;
            lifecycleInstance = null;
            parentInstance = null;
            childInstance = null;
            
            // é‡ç½®UIçŠ¶æ€
            document.querySelectorAll('.component-instance').forEach(el => {
                el.classList.remove('mounted', 'unmounted');
                el.querySelector('.component-status').textContent = 'Created';
                el.querySelector('.component-status').className = 'component-status status-created';
            });
            
            // ç¦ç”¨æŒ‰é’®
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.textContent.includes('æŒ‚è½½') || btn.textContent.includes('åˆ·æ–°') || btn.textContent.includes('æ¸…ç†') || btn.textContent.includes('æ›´æ–°æ¶ˆæ¯')) {
                    btn.disabled = false;
                } else {
                    btn.disabled = true;
                }
            });
            
            refreshStats();
            console.log('ğŸ§¹ æ‰€æœ‰ç»„ä»¶å·²æ¸…ç†');
        }

        // è¾…åŠ©å‡½æ•°
        function highlightElement(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.classList.add('highlight');
                setTimeout(() => {
                    element.classList.remove('highlight');
                }, 1000);
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ‰ Vue3ç»„ä»¶åŸºç¡€æ¶æ„æ¼”ç¤ºé¡µé¢å·²åŠ è½½');
            refreshStats();
            
            // å®šæœŸåˆ·æ–°ç»Ÿè®¡ä¿¡æ¯
            setInterval(refreshStats, 2000);
        });
    </script>
</body>
</html> 